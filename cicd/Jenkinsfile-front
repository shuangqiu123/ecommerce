pipeline {
	agent any

	environment {
		DIST_PATH = '/var/lib/jenkins/workspace/demostore-frontend/frontend/dist'
		HOME = '.'
	}
	stages {
		stage('Installing dependencies') {
			steps {
				dir('./frontend') {
					echo "Installing dependencies in package.json"
					sh 'npm install'
				}
			}
		}

		stage('Build dist files') {
			steps {
				dir('./frontend') {
					sh 'npm run build'
				}
			}
		}

		stage('Deploying static dist files to S3') {
			steps {
				echo 'deploying to S3'
				withAWS(credentials: 'aws-credentials', region: 'ap-southeast-2') {
					sh 'aws s3 rm "${BUCKET}"'
					sh 'aws s3 cp "${DIST_PATH}" "${BUCKET}" --recursive --acl public-read'
				}
			}
		}
	}
}